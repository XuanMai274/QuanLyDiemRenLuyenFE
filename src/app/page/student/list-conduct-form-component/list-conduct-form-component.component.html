<div class="conduct-forms-container">
  <!-- <h3 class="section-title mb-4">
    <i class="bi bi-clipboard2-check text-primary me-2"></i>
    Danh sách phiếu rèn luyện của bạn
  </h3> -->

  <div class="card shadow-sm mb-5">
    <table class="table custom-table align-middle">
      <thead>
        <tr>
          <th>Tổng điểm</th>
          <th>Xếp loại</th>
          <th>Trạng thái</th>
          <th>Ghi chú</th>
          <th>Hành động</th>
        </tr>
      </thead>

      <tbody *ngIf="conductForms && conductForms.length > 0; else noData">
        <ng-container *ngFor="let form of conductForms; let i = index">
          <tr class="semester-row">
            <td colspan="5" class="semester-header">
              <i class="bi bi-calendar3 me-2"></i>
              {{ form.semester?.semesterName }} ({{ form.semester?.year }})
            </td>
          </tr>

          <tr>
            <td *ngIf="form.totalStudentScore !== undefined" [ngClass]="{
              'high-score': +form.totalStudentScore >= 80,
              'medium-score': +form.totalStudentScore >= 50 && +form.totalStudentScore < 80,
              'low-score': +form.totalStudentScore < 50
            }">
              <i class="fa-solid fa-chart-line"></i>
              {{ form.staffScore| number: '1.0-2' }}
            </td>

            <td><span class="badge bg-info">{{ Grade(form.staffScore ?? 0) }}</span></td>
            <td>
              <span class="badge status-badge" [ngClass]="{
                  'pending': form.status === 'PENDING',
                  'approved': form.status === 'APPROVED'
                }">
                {{ form.status === 'PENDING' ? 'Đang chờ duyệt' : 'Đã duyệt' }}
              </span>
            </td>
            <td class="text-muted fst-italic">--</td>
            <td>
              <button class="btn action-btn" [ngClass]="getButtonClass(form)" (click)="onAction(form)">
                {{ getButtonLabel(form) }}
              </button>
            </td>
          </tr>
        </ng-container>
      </tbody>

      <ng-template #noData>
        <tr>
          <td colspan="5" class="text-center text-muted py-4">Không có dữ liệu</td>
        </tr>
      </ng-template>
    </table>
  </div>

  <h4 class="section-subtitle mb-3">
    <i class="bi bi-hourglass-split text-success me-2"></i>
    Các học kỳ đang mở đánh giá
  </h4>

  <div class="card shadow-sm">
    <table class="table custom-table align-middle">
      <thead>
        <tr>
          <th>Tên học kỳ</th>
          <th>Năm học</th>
          <th>Thời gian bắt đầu</th>
          <th>Thời gian kết thúc</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody *ngIf="openSemesters && openSemesters.length > 0; else noOpenSemester">
        <tr *ngFor="let semester of openSemesters">
          <td>{{ semester.semesterName }}</td>
          <td>{{ semester.year }}</td>
          <td>{{ semester.evaluationStartDate }}</td>
          <td>{{ semester.evaluationEndDate  }}</td>
          <td>
            <button class="btn btn-outline-primary btn-sm" (click)="onCreateConductForm(semester.semesterId)">
              <i class="bi bi-pencil-square me-1"></i> Đánh giá
            </button>
          </td>
        </tr>
      </tbody>

      <ng-template #noOpenSemester>
        <tr>
          <td colspan="5" class="text-center text-muted py-4">
            Hiện không có học kỳ nào đang mở đánh giá
          </td>
        </tr>
      </ng-template>
    </table>
  </div>
</div>
